<!DOCTYPE html>  <html> <head>   <title>int17.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="int17.html">                 int17.js               </a>                                           <a class="source" href="node.html">                 node.js               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               int17.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p><a href="http://neocotic.com/int17">int17</a> 0.2.2 <br />
Copyright (c) 2013 Alasdair Mercer <br />
Freely distributable under the MIT license. <br />
For all details and documentation: <br />
<a href="http://neocotic.com/int17">http://neocotic.com/int17</a></p>             </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>

  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Private constants</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Prefix for HTML5 data attributes.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">DATA_ATTR_PREFIX</span> <span class="o">=</span> <span class="s1">&#39;data-&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Default locale to be used if none could be derived.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">DEFAULT_LOCALE</span>   <span class="o">=</span> <span class="s1">&#39;en&#39;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Map of HTML entities for escaping.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">ENTITY_MAP</span>       <span class="o">=</span> <span class="p">{</span>
          <span class="s1">&#39;&amp;&#39;</span><span class="o">:</span>  <span class="s1">&#39;&amp;amp;&#39;</span>
        <span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="o">:</span>  <span class="s1">&#39;&amp;lt;&#39;</span>
        <span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="o">:</span>  <span class="s1">&#39;&amp;gt;&#39;</span>
        <span class="p">,</span> <span class="s1">&#39;&quot;&#39;</span><span class="o">:</span>  <span class="s1">&#39;&amp;quot;&#39;</span>
        <span class="p">,</span> <span class="s1">&#39;\&#39;&#39;</span><span class="o">:</span> <span class="s1">&#39;&amp;#x27;&#39;</span>
        <span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="o">:</span>  <span class="s1">&#39;&amp;#x2F;&#39;</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>List of method names whose result is escaped for HTML interpolation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">ESCAPE_METHODS</span>   <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="s1">&#39;get&#39;</span><span class="p">,</span> <span class="s1">&#39;map&#39;</span><span class="p">]</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Save the previous value of the global <code>int17</code> variable.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">PREVIOUS_INT17</span>   <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">int17</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Regular expression used for escaping HTML entities.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">R_ESCAPE</span>         <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">keys</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">ENTITY_MAP</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">keys</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nx">keys</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">);</span>
      <span class="p">})()</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>Regular expression used to split locales.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">R_LOCALE</span>         <span class="o">=</span> <span class="sr">/[\-_]/</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Regular expression used to extract the parent segment from locales.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">R_PARENT</span>         <span class="o">=</span> <span class="sr">/^([^\-_]+)[\-_]/</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Regular expression used to replace placeholders in messages.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">R_PLACEHOLDER</span>    <span class="o">=</span> <span class="sr">/\$(\w+)\$/gi</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Regular expression used to replace substitutions in messages.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">R_SUBSTITUTION</span>   <span class="o">=</span> <span class="sr">/\$([1-9]\d*)/gi</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Regular expression used to seperate key/value pairs.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">R_VALUES</span>         <span class="o">=</span> <span class="sr">/^([^:]+):(.+)$/</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Regular expression used to replace whitespace.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">R_WHITESPACE</span>     <span class="o">=</span> <span class="sr">/\s/g</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Name of the substitutions attributes used internally by the <code>handlers</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">SUBS_ATTRIBUTES</span>  <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;int17-subs&#39;</span><span class="p">];</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Add support for HTML5 data attribute version of <code>int17-subs</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">SUBS_ATTRIBUTES</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">DATA_ATTR_PREFIX</span> <span class="o">+</span> <span class="nx">SUBS_ATTRIBUTES</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <h2>Private variables</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Reference to the global object.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">root</span>     <span class="o">=</span> <span class="k">this</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Quick reference to core prototypes.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">slice</span>    <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span>
    <span class="p">,</span> <span class="nx">toString</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <h2>Private functions</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>Return the type of the specified <code>object</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">type</span><span class="p">(</span><span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">object</span><span class="p">).</span><span class="nx">toLowerCase</span><span class="p">().</span><span class="nx">slice</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p>Call <code>callback</code> in the specified <code>context</code> if it's a valid function. <br />
All other arguments will be passed on to <code>callback</code> but if the first argument is non-null this
indicates an error which will be thrown if <code>callback</code> is invalid.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">callOrThrow</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p>Escape the <code>string</code> provided to HTML interpolation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">string</span><span class="p">)</span> <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="o">+</span> <span class="nx">string</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="nx">R_ESCAPE</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">ENTITY_MAP</span><span class="p">[</span><span class="nx">match</span><span class="p">];</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Filter only <code>languages</code> that extend from the specified <code>parent</code> locale.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">filterLanguages</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">languages</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">match</span>
      <span class="p">,</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">languages</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="nx">languages</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">R_PARENT</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">===</span> <span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">languages</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Retrieve the target value on an <code>object</code>. <br />
Optionally, the search can be case-insensitive which will take slightly longer as all
properties are checked until a match is found.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">findProp</span><span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">target</span><span class="p">,</span> <span class="nx">ignoreCase</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ignoreCase</span><span class="p">)</span> <span class="k">return</span> <span class="nx">object</span><span class="p">[</span><span class="nx">target</span><span class="p">];</span>
    <span class="nx">target</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">object</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">target</span> <span class="o">===</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">())</span> <span class="k">return</span> <span class="nx">object</span><span class="p">[</span><span class="nx">prop</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Extract any substitutions from the specified <code>element</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">getSubstitutions</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">subs</span>
      <span class="p">,</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">SUBS_ATTRIBUTES</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">subs</span>    <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="nx">SUBS_ATTRIBUTES</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">subs</span> <span class="o">?</span> <span class="nx">subs</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="o">:</span> <span class="p">[]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Return a validator for determining whether a value is a non-empty string.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">isNonEmptyString</span><span class="p">(</span><span class="nx">negate</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="o">||</span> <span class="nx">negate</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Return a validator for determining whether a value is of the named type.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">isType</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">negate</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">name</span> <span class="o">=</span> <span class="nx">name</span> <span class="o">&amp;&amp;</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">type</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="nx">name</span> <span class="o">||</span> <span class="nx">negate</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Return a replace for substituting placeholders within optimized messages.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">replaceOptimized</span><span class="p">(</span><span class="nx">placeholders</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">replacement</span> <span class="o">=</span> <span class="nx">findProp</span><span class="p">(</span><span class="nx">placeholders</span><span class="p">,</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">type</span><span class="p">(</span><span class="nx">replacement</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">?</span> <span class="nx">replacement</span> <span class="o">:</span> <span class="nx">placeholder</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Return a replacer for substituting placeholders within potentially optimized messages.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">replacer</span><span class="p">(</span><span class="nx">placeholders</span><span class="p">,</span> <span class="nx">optimized</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">optimized</span> <span class="o">?</span> <span class="nx">replaceOptimized</span> <span class="o">:</span> <span class="nx">replaceStandard</span><span class="p">)(</span><span class="nx">placeholders</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>Return a replace for substituting placeholders within non-optimized messages.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">replaceStandard</span><span class="p">(</span><span class="nx">placeholders</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">replacement</span> <span class="o">=</span> <span class="nx">findProp</span><span class="p">(</span><span class="nx">placeholders</span><span class="p">,</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
      <span class="nx">replacement</span>     <span class="o">=</span> <span class="nx">replacement</span> <span class="o">&amp;&amp;</span> <span class="nx">replacement</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
      <span class="k">return</span> <span class="nx">type</span><span class="p">(</span><span class="nx">replacement</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">?</span> <span class="nx">replacement</span> <span class="o">:</span> <span class="nx">placeholder</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Retrieve the message contents with all occurrences of placeholders replaced, including numeric
placeholders which represent substitution indices. <br />
Internal placeholders are replaced first, followed by the substitutions to improve
performance.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">substitute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">optimized</span><span class="p">,</span> <span class="nx">substitutions</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">placeholders</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">placeholders</span>
      <span class="p">,</span> <span class="nx">str</span>          <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">message</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">placeholders</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">R_PLACEHOLDER</span><span class="p">,</span> <span class="nx">replacer</span><span class="p">(</span><span class="nx">placeholders</span><span class="p">,</span> <span class="nx">optimized</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">substitutions</span> <span class="o">&amp;&amp;</span> <span class="nx">substitutions</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">str</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">R_SUBSTITUTION</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">sub</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">index</span> <span class="o">=</span> <span class="nx">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">type</span><span class="p">(</span><span class="nx">substitutions</span><span class="p">[</span><span class="nx">index</span><span class="p">])</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span> <span class="o">?</span> <span class="nx">substitutions</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">:</span> <span class="nx">sub</span><span class="p">;</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">str</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Validate the specified <code>message</code>, throwing appropriate errors if any validations fail. <br />
It is recommended that this is used during development but disabled in production environments
to improve performance.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">validateMessage</span><span class="p">(</span><span class="nx">messageName</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;Message[&#39;</span> <span class="o">+</span> <span class="nx">messageName</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39; is not an object&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">message</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;.message is not a string&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;placeholders&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">placeholders</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;.placeholders is not an object&#39;</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-34">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-34">&#182;</a>               </div>               <p>Validate the specified <code>placeholder</code>, throwing appropriate errors if any validations fail. <br />
It is recommended that this is used during development but disabled in production environments
to improve performance.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">validatePlaceholder</span><span class="p">(</span><span class="nx">messageName</span><span class="p">,</span> <span class="nx">placeholderName</span><span class="p">,</span> <span class="nx">placeholder</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">prefix</span> <span class="o">=</span> <span class="s1">&#39;Message[&#39;</span> <span class="o">+</span> <span class="nx">messageName</span> <span class="o">+</span> <span class="s1">&#39;].placeholders[&#39;</span> <span class="o">+</span> <span class="nx">placeholderName</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39; is not an object&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">.</span><span class="nx">content</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="nx">prefix</span> <span class="o">+</span> <span class="s1">&#39;.content is not a string&#39;</span><span class="p">);</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-35">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-35">&#182;</a>               </div>               <p>Flatten all <code>args</code> passed into single array.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">vargs</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">args</span> <span class="o">=</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">args</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">results</span> <span class="o">=</span> <span class="nx">results</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-36">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-36">&#182;</a>               </div>               <h2>Handlers</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-37">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-37">&#182;</a>               </div>               <p>Mapping for internationalization handlers. <br />
Each handler represents an attribute (based on the property name) and is called for each
attribute found within the node currently being processed. <br />
To specify substitutions by a handler, that element should also have semi-colon separated
values declared within an <code>int17-subs</code> attribute.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">handlers</span> <span class="o">=</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-38">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-38">&#182;</a>               </div>               <p>Replace the HTML content of <code>element</code> with the named message looked up for <code>name</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="s1">&#39;int17-content&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">element</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">getSubstitutions</span><span class="p">(</span><span class="nx">element</span><span class="p">));</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-39">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-39">&#182;</a>               </div>               <p>Adds options to the <code>element</code> with the messages looked up for <code>names</code>. <br />
<code>names</code> should be semi-colon separated values where each value is treated as a message
name which themselves can be separated by colons to divide them into two parts. The
first part specifying the message name for the option's HTML contents while the second
specifies the actual value for the option.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">,</span> <span class="s1">&#39;int17-options&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">names</span> <span class="o">=</span> <span class="nx">names</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">R_WHITESPACE</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">names</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">option</span><span class="p">,</span> <span class="nx">parts</span>
              <span class="p">,</span> <span class="nx">subs</span> <span class="o">=</span> <span class="nx">getSubstitutions</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">option</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
              <span class="nx">parts</span>  <span class="o">=</span> <span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">R_VALUES</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">parts</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">option</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">subs</span><span class="p">);</span>
                <span class="nx">option</span><span class="p">.</span><span class="nx">value</span>     <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">option</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">subs</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="nx">element</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-40">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-40">&#182;</a>               </div>               <p>Replace the value of the properties and/or attributes of <code>element</code> with the messages
looked up for their corresponding values. <br />
<code>values</code> should be semi-colon separated values where each value is itself made up of
two parts (separated by colons), the property path/attribute name and the message
name. <br />
Property paths are interperated as different from attribute names by beginning with a
full stop/period character and can well contain more (e.g. <code>.style.direction:dir</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="p">,</span> <span class="s1">&#39;int17-values&#39;</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">values</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">values</span> <span class="o">=</span> <span class="nx">values</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">R_WHITESPACE</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">values</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">expression</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">paths</span><span class="p">,</span> <span class="nx">property</span>
              <span class="p">,</span> <span class="nx">subs</span> <span class="o">=</span> <span class="nx">getSubstitutions</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">values</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">property</span> <span class="o">=</span> <span class="nx">values</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">R_VALUES</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">property</span><span class="p">)</span> <span class="k">continue</span><span class="p">;</span>
              <span class="nx">name</span>       <span class="o">=</span> <span class="nx">property</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
              <span class="nx">expression</span> <span class="o">=</span> <span class="nx">property</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">paths</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
                <span class="nx">obj</span>   <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
                <span class="k">while</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">paths</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">paths</span><span class="p">.</span><span class="nx">shift</span><span class="p">()];</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
                  <span class="nx">obj</span><span class="p">[</span><span class="nx">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">subs</span><span class="p">);</span>
                  <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="nx">SUBS_ATTRIBUTES</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
                    <span class="nx">subs</span> <span class="o">=</span> <span class="nx">getSubstitutions</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
                  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;innerHTML&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">element</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">expression</span><span class="p">,</span> <span class="nx">subs</span><span class="p">));</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">~</span><span class="nx">SUBS_ATTRIBUTES</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
                  <span class="nx">subs</span> <span class="o">=</span> <span class="nx">getSubstitutions</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>

      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-41">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-41">&#182;</a>               </div>               <p>List of internationalization attributes/handlers available. <br />
During the population of this list, additional handlers are added to support HTML5 data
attribute names. Doing this now avoids the need for a second iteration through the
handlers, thus improving performance.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">attributes</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">attribute</span><span class="p">,</span> <span class="nx">dataAttribute</span>
          <span class="p">,</span> <span class="nx">results</span> <span class="o">=</span> <span class="p">[];</span></pre></div>             </td>           </tr>                               <tr id="section-42">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-42">&#182;</a>               </div>               <p>Create a new function that redirects the method call to the corresponding
non-data-attribute handler.</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="kd">function</span> <span class="nx">redirect</span><span class="p">(</span><span class="nx">attribute</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">handlers</span><span class="p">[</span><span class="nx">attribute</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">arguments</span><span class="p">);</span>
          <span class="p">};</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">attribute</span> <span class="k">in</span> <span class="nx">handlers</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">handlers</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">attribute</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-43">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-43">&#182;</a>               </div>               <p>Add a handler for the associated data attribute to redirect it's calls accordingly.</p>             </td>             <td class="code">               <div class="highlight"><pre>          <span class="nx">dataAttribute</span>           <span class="o">=</span> <span class="nx">DATA_ATTR_PREFIX</span> <span class="o">+</span> <span class="nx">attribute</span><span class="p">;</span>
          <span class="nx">handlers</span><span class="p">[</span><span class="nx">dataAttribute</span><span class="p">]</span> <span class="o">=</span> <span class="nx">redirect</span><span class="p">(</span><span class="nx">attribute</span><span class="p">);</span>
          <span class="nx">results</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">attribute</span><span class="p">,</span> <span class="nx">dataAttribute</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">results</span><span class="p">;</span>
      <span class="p">}())</span></pre></div>             </td>           </tr>                               <tr id="section-44">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-44">&#182;</a>               </div>               <p>Selector containing the available internationalization attributes/handlers which are used
by <code>traverse</code> to query all elements.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="p">,</span> <span class="nx">selector</span>   <span class="o">=</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;],[&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-45">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-45">&#182;</a>               </div>               <h2>Messenger</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-46">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-46">&#182;</a>               </div>               <p>Creates a new instance of <code>Messenger</code> for the specified <code>int17</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">Messenger</span><span class="p">(</span><span class="nx">int17</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">int17</span> <span class="o">=</span> <span class="nx">int17</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">configure</span><span class="p">();</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-47">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-47">&#182;</a>               </div>               <p>Perform any optimizations and/or validations on the specified <code>message</code> and all of its
placeholders, where appropriate. <br />
Errors will be thrown if any validation failures occur during this process.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkMessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">validateMessage</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">message</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">key</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="nx">message</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">case</span> <span class="s1">&#39;placeholders&#39;</span><span class="o">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">checkPlaceholders</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">case</span> <span class="s1">&#39;message&#39;</span><span class="o">:</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="k">default</span><span class="o">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">optimize</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">delete</span> <span class="nx">message</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">message</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-48">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-48">&#182;</a>               </div>               <p>Optimize and/or validate all of the specified <code>messages</code> along with all of their placeholders,
where possible. <br />
Errors will be thrown if any validation failures occur during this process.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkMessages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">messages</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">name</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">messages</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">messages</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">checkMessage</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">messages</span><span class="p">[</span><span class="nx">name</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">messages</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-49">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-49">&#182;</a>               </div>               <p>Optimize and/or validate all of the specified <code>placeholders</code>, where possible. <br />
Errors will be thrown if any validation failures occur during this process.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">checkPlaceholders</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">messageName</span><span class="p">,</span> <span class="nx">placeholders</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lcName</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">placeholder</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">name</span> <span class="k">in</span> <span class="nx">placeholders</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">placeholders</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">name</span><span class="p">))</span> <span class="k">continue</span><span class="p">;</span>
      <span class="nx">placeholder</span> <span class="o">=</span> <span class="nx">placeholders</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">validatePlaceholder</span><span class="p">(</span><span class="nx">messageName</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">placeholder</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">optimize</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">lcName</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
        <span class="k">delete</span> <span class="nx">placeholders</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
        <span class="nx">placeholders</span><span class="p">[</span><span class="nx">lcName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">placeholder</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">placeholders</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-50">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-50">&#182;</a>               </div>               <p>Configure this <code>Messenger</code> based on the specified <code>options</code>. <br />
Default configuration values will be used for any options that are missing or invalid. <br />
<em>Warning:</em> This function removes all previously fetched messages so <code>loadMessages</code> should be
called immediately after to avoid unpredictable behaviour.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">configure</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">locale</span> <span class="o">&amp;&amp;</span> <span class="nx">type</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">locale</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;array&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">options</span><span class="p">.</span><span class="nx">locale</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">R_LOCALE</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;clean&#39;</span><span class="p">,</span>     <span class="nx">options</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span>       <span class="nx">isType</span><span class="p">(</span><span class="s1">&#39;boolean&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;encoding&#39;</span><span class="p">,</span>  <span class="nx">options</span><span class="p">,</span> <span class="s1">&#39;UTF-8&#39;</span><span class="p">,</span>     <span class="nx">isNonEmptyString</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;extension&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="s1">&#39;.json&#39;</span><span class="p">,</span>     <span class="nx">isNonEmptyString</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;fallback&#39;</span><span class="p">,</span>  <span class="nx">options</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span>       <span class="nx">isType</span><span class="p">(</span><span class="s1">&#39;boolean&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;fileName&#39;</span><span class="p">,</span>  <span class="nx">options</span><span class="p">,</span> <span class="s1">&#39;messages&#39;</span><span class="p">,</span>  <span class="nx">isNonEmptyString</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;folders&#39;</span><span class="p">,</span>   <span class="nx">options</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span>       <span class="nx">isType</span><span class="p">(</span><span class="s1">&#39;boolean&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;languages&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="p">[],</span>          <span class="nx">isType</span><span class="p">(</span><span class="s1">&#39;array&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;locale&#39;</span><span class="p">,</span>    <span class="nx">options</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span>        <span class="nx">isType</span><span class="p">(</span><span class="s1">&#39;array&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;optimize&#39;</span><span class="p">,</span>  <span class="nx">options</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>        <span class="nx">isType</span><span class="p">(</span><span class="s1">&#39;boolean&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">,</span>      <span class="nx">options</span><span class="p">,</span> <span class="s1">&#39;./locales&#39;</span><span class="p">,</span> <span class="nx">isNonEmptyString</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;separator&#39;</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>         <span class="nx">isNonEmptyString</span><span class="p">());</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">setUp</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">,</span>  <span class="nx">options</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span>        <span class="nx">isType</span><span class="p">(</span><span class="s1">&#39;boolean&#39;</span><span class="p">));</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">languages</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">reconfigure</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-51">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-51">&#182;</a>               </div>               <p>Attempt to derive the locale from the current environment or fallback on <code>DEFAULT_LOCALE</code>. <br />
Locales are stored in segments so <code>'en-US'</code> would be stored as <code>['en', 'GB']</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">deriveLocale</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">locale</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">locale</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">extractLocale</span><span class="p">()</span> <span class="o">||</span> <span class="nx">DEFAULT_LOCALE</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="nx">R_LOCALE</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">locale</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-52">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-52">&#182;</a>               </div>               <p>Attempt to extract the locale from the current runtime environment.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">extractLocale</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">html</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;html&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">html</span> <span class="o">&amp;&amp;</span> <span class="nx">html</span><span class="p">.</span><span class="nx">lang</span><span class="p">)</span> <span class="k">return</span> <span class="nx">html</span><span class="p">.</span><span class="nx">lang</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">language</span><span class="p">)</span> <span class="k">return</span> <span class="nx">navigator</span><span class="p">.</span><span class="nx">language</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-53">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-53">&#182;</a>               </div>               <p>Retrieve the named message from the bundle.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getMessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">[</span><span class="nx">name</span><span class="p">];</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-54">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-54">&#182;</a>               </div>               <p>Retrieve the absolute/relative path of the file for the current locale.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getLocaleFile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">relative</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLocaleParent</span><span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">separator</span><span class="p">;</span>
    <span class="nx">path</span>    <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">folders</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">fileName</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">);</span>
    <span class="nx">path</span>    <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">extension</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">relative</span> <span class="o">?</span> <span class="nx">path</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">resolvePath</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-55">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-55">&#182;</a>               </div>               <p>Retrieve the absolute/relative path of the directory containing the file for the current
locale.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getLocaleParent</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">relative</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLocaleRoot</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">folders</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">path</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">separator</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">relative</span> <span class="o">?</span> <span class="nx">path</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">resolvePath</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-56">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-56">&#182;</a>               </div>               <p>Retrieve the absolute/relative path of the root directory containing the locale files or
sub-directories.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getLocaleRoot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">relative</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">path</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">relative</span> <span class="o">?</span> <span class="nx">path</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">resolvePath</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-57">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-57">&#182;</a>               </div>               <p>Asynchronously load the message resource into a local bundle. <br />
As the bundle is stored locally, subsequent calls will result in the previously loaded
messages. <br />
If no resource file could be found for the current locale, a second attempt is made so long as
the locale has a <em>parent</em> (e.g. <code>en-GB</code> but not <code>en</code>) and the relevant option is enabled;
otherwise, an appropriate error will be raised.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadMessages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">original</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">)</span> <span class="k">return</span> <span class="nx">callOrThrow</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">deriveLocale</span><span class="p">();</span>
      <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span>
        <span class="p">,</span> <span class="nx">xhr</span>  <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
      <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLocaleFile</span><span class="p">(),</span> <span class="kc">true</span><span class="p">);</span>
      <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
              <span class="nx">that</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">parseMessages</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
              <span class="nx">callOrThrow</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">messages</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">callOrThrow</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">fallback</span> <span class="o">&amp;&amp;</span> <span class="nx">original</span> <span class="o">&amp;&amp;</span> <span class="nx">that</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">that</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
              <span class="nx">that</span><span class="p">.</span><span class="nx">loadMessages</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="nx">callOrThrow</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span><span class="p">));</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">};</span>
      <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callOrThrow</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-58">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-58">&#182;</a>               </div>               <p>Synchronously load the message resource into a local bundle. <br />
As the bundle is stored locally, the previously loaded messages will be returned by subsequent
calls. <br />
If no resource file could be found for the current locale, a second attempt is made so long as
the locale has a <em>parent</em> (e.g. <code>en-GB</code> but not <code>en</code>) and the relevant option is enabled;
otherwise, an appropriate error will be thrown.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadMessagesSync</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">original</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">deriveLocale</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">getLocaleFile</span><span class="p">(),</span> <span class="kc">false</span><span class="p">);</span>
    <span class="nx">xhr</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">===</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseMessages</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">fallback</span> <span class="o">&amp;&amp;</span> <span class="nx">original</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
      <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">loadMessagesSync</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">statusText</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-59">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-59">&#182;</a>               </div>               <p>Transform the <code>contents</code> of a locale resource file into a message bundle. <br />
The messages may be optimized and/or validated if the relevant options are enabled.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">parseMessages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">contents</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">messages</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">contents</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">optimize</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">validate</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">checkMessages</span><span class="p">(</span><span class="nx">messages</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">messages</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-60">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-60">&#182;</a>               </div>               <p>Placeholder to allow override of configuration settings without too much duplication.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reconfigure</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-61">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-61">&#182;</a>               </div>               <p>Derive an absolute path from the relative <code>path</code> provided.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">resolvePath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">anchor</span>  <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span>
    <span class="nx">anchor</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">anchor</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-62">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-62">&#182;</a>               </div>               <p>Set the value of the specified property on this <code>Messenger</code> as that taken from an object. <br />
All remaining arguments should be validation functions which, if any fail, results in the
default value being set instead.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Messenger</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setUp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">property</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">defaultValue</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">validators</span> <span class="o">=</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
      <span class="p">,</span> <span class="nx">value</span>      <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">property</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">validators</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validators</span><span class="p">[</span><span class="nx">i</span><span class="p">](</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">:</span> <span class="nx">defaultValue</span><span class="p">;</span>
        <span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">[</span><span class="nx">property</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-63">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-63">&#182;</a>               </div>               <h2>Internationalization</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-64">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-64">&#182;</a>               </div>               <p>Creates a new instance of <code>Internationalization</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">Internationalization</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messenger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Messenger</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">node</span>      <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-65">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-65">&#182;</a>               </div>               <p>Create the <code>escape</code> namespace for methods enabling HTML interpolation.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">i</span>
      <span class="p">,</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">escape</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="kd">function</span> <span class="nx">bindEscape</span><span class="p">(</span><span class="nx">method</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">that</span><span class="p">.</span><span class="nx">escape</span><span class="p">[</span><span class="nx">method</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span>
          <span class="p">,</span> <span class="nx">alreadyEscaping</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">escaping</span><span class="p">;</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">escaping</span>       <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">{</span>
          <span class="nx">result</span> <span class="o">=</span> <span class="nx">that</span><span class="p">[</span><span class="nx">method</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">));</span>
        <span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">alreadyEscaping</span><span class="p">)</span> <span class="k">delete</span> <span class="nx">that</span><span class="p">.</span><span class="nx">escaping</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
      <span class="p">};</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ESCAPE_METHODS</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">bindEscape</span><span class="p">(</span><span class="nx">ESCAPE_METHODS</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-66">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-66">&#182;</a>               </div>               <p>Retrieve the localized messages for each of the specified <code>names</code> in the order they were
given. <br />
The contents of <code>names</code> can be a mixture of strings and objects. When the latter is used, the
its <code>name</code> property specifies the name of the localized message and the <code>subs</code> property should
be an array to be used as substitutions when fetching the message. <br />
Any additional arguments are used as substitutions for numeric placeholders, except where
<code>subs</code> properties are specified. <br />
Call <code>escape.all</code> if you want to escape the messages for HTML interpolation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">all</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">messageSubs</span><span class="p">,</span> <span class="nx">name</span>
      <span class="p">,</span> <span class="nx">messages</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="p">,</span> <span class="nx">subs</span>     <span class="o">=</span> <span class="nx">vargs</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">messageSubs</span> <span class="o">=</span> <span class="nx">subs</span><span class="p">;</span>
        <span class="nx">name</span>        <span class="o">=</span> <span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">messageSubs</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">subs</span> <span class="o">||</span> <span class="nx">messageSubs</span><span class="p">;</span>
          <span class="nx">name</span>        <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">messages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">messageSubs</span><span class="p">));</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">messages</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-67">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-67">&#182;</a>               </div>               <p>Set the value of the given attribute on all selected elements to the localized message for the
specified <code>name</code>. <br />
Any additional arguments are used as substitutions for numeric placeholders.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">attribute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">attr</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">subs</span>     <span class="o">=</span> <span class="nx">vargs</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
      <span class="p">,</span> <span class="nx">elements</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span>
      <span class="p">,</span> <span class="nx">message</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">subs</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">attr</span><span class="p">,</span> <span class="nx">message</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-68">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-68">&#182;</a>               </div>               <p>Set the content of all selected elements to the localized message for the specified <code>name</code>. <br />
Any additional arguments are used as substitutions for numeric placeholders.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">content</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">subs</span>     <span class="o">=</span> <span class="nx">vargs</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
      <span class="p">,</span> <span class="nx">elements</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span>
      <span class="p">,</span> <span class="nx">message</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">subs</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-69">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-69">&#182;</a>               </div>               <p>Retrieve the localized message for the specified <code>name</code>. <br />
Any additional arguments are used as substitutions for numeric placeholders. <br />
Call <code>escape.get</code> if you want to escape the message for HTML interpolation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">subs</span>    <span class="o">=</span> <span class="nx">vargs</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
      <span class="p">,</span> <span class="nx">message</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">getMessage</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
    <span class="nx">message</span> <span class="o">=</span> <span class="nx">message</span> <span class="o">&amp;&amp;</span> <span class="nx">substitute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">optimize</span><span class="p">,</span> <span class="nx">subs</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">escaping</span> <span class="o">?</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">:</span> <span class="nx">message</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-70">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-70">&#182;</a>               </div>               <p>Initialize this instance, optionall passing in <code>options</code> to modify the configuration. <br />
During this process the messages for the configured locale will be <strong>asynchronously</strong> loaded
from its resource file.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
      <span class="nx">options</span>  <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">options</span><span class="p">).</span><span class="nx">loadMessages</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">callOrThrow</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callOrThrow</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-71">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-71">&#182;</a>               </div>               <p>Initialize this instance, optionall passing in <code>options</code> to modify the configuration. <br />
During this process the messages for the configured locale will be <strong>synchronously</strong> loaded
from its resource file.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initSync</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">configure</span><span class="p">(</span><span class="nx">options</span><span class="p">).</span><span class="nx">loadMessagesSync</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-72">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-72">&#182;</a>               </div>               <p>Asynchronously fetch all of the supported languages, optionally specifying a <code>parent</code> locale
for which only its <em>children</em> should be retrieved (e.g. <code>en</code> could fetch <code>en-GB</code> and <code>en-US</code>
but not <code>en</code>, <code>fr</code>, or <code>fr-BE</code>). <br />
To optimize the performance of this function, the languages are only populated once. <br />
The asynchronous aspect is only present in the overriden functionality available for the
Node.js environment. However, the pattern also exists in the browser for consistency. <br />
Also, as the browser isn't aware of all available languages, the only languages in the results
can be the current locale provided it isn't filtered out by the <code>parent</code> argument. The only
workaround for this is by using the <code>languages</code> option during initialization.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">languages</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callback</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">;</span>
      <span class="nx">parent</span>   <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">languages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">languagesSync</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
      <span class="nx">callOrThrow</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">languages</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">callOrThrow</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">callback</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-73">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-73">&#182;</a>               </div>               <p>Retrieve all of the supported languages, optionally specifying a <code>parent</code> locale for which
only its <em>children</em> should be retrieved (e.g. <code>en</code> could return <code>en-GB</code> and <code>en-US</code> but not
<code>en</code>, <code>fr</code>, or <code>fr-BE</code>). <br />
To optimize the performance of this function, the languages are only populated once. <br />
As the browser isn't aware of all available languages, the only languages in the results can
be the current locale provided it isn't filtered out by the <code>parent</code> argument. The only
workaround for this is by using the <code>languages</code> option during initialization.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">languagesSync</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">languages</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">languages</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span><span class="p">)</span> <span class="k">return</span> <span class="nx">filterLanguages</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">languagesSync</span><span class="p">());</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">languages</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">languages</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">languages</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-74">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-74">&#182;</a>               </div>               <p>Retrieve the current locale (e.g. <code>en</code>, <code>en-GB</code>).</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">locale</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">locale</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-75">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-75">&#182;</a>               </div>               <p>Map all of the specified <code>names</code> to their corresponding localized messages. <br />
The contents of <code>names</code> can be a mixture of strings and objects. When the latter is used, the
its <code>name</code> property specifies the name of the localized message and the <code>subs</code> property should
be an array to be used as substitutions when fetching the message. <br />
The resulting map will use name parts as keys (strings or <code>name</code> property of objects). <br />
Any additional arguments are used as substitutions for numeric placeholders, except where
<code>subs</code> properties are specified. <br />
Call <code>escape.map</code> if you want to escape the messages for HTML interpolation.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">map</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">messageSubs</span><span class="p">,</span> <span class="nx">name</span>
      <span class="p">,</span> <span class="nx">messages</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="p">,</span> <span class="nx">subs</span>     <span class="o">=</span> <span class="nx">vargs</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">messageSubs</span> <span class="o">=</span> <span class="nx">subs</span><span class="p">;</span>
        <span class="nx">name</span>        <span class="o">=</span> <span class="nx">names</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">messageSubs</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">subs</span> <span class="o">||</span> <span class="nx">messageSubs</span><span class="p">;</span>
          <span class="nx">name</span>        <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">messages</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">messageSubs</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">messages</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-76">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-76">&#182;</a>               </div>               <p>Create HTML option elements containing the localized message for each of the specified <code>names</code>
and inserts them into all selected elements. <br />
The contents of <code>names</code> can be a mixture of strings and objects. When the latter is used, the
its <code>name</code> property specifies the localized message for the option's HTML contents, the
<code>value</code> property specifies the actual value for the option, and the <code>subs</code> property should be
an array to be used as substitutions when fetching the message. <br />
Any additional arguments are used as substitutions for numeric placeholders, except where
<code>subs</code> properties are specified.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span> <span class="o">||</span> <span class="o">!</span><span class="nx">names</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">messageSubs</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">option</span>
      <span class="p">,</span> <span class="nx">elements</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span>
      <span class="p">,</span> <span class="nx">subs</span>     <span class="o">=</span> <span class="nx">vargs</span><span class="p">([].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">names</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">messageSubs</span> <span class="o">=</span> <span class="nx">subs</span><span class="p">;</span>
        <span class="nx">name</span>        <span class="o">=</span> <span class="nx">names</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
        <span class="nx">option</span>      <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;option&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">option</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="nx">messageSubs</span>  <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">subs</span> <span class="o">||</span> <span class="nx">messageSubs</span><span class="p">;</span>
          <span class="nx">name</span>         <span class="o">=</span> <span class="nx">name</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="nx">option</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">messageSubs</span><span class="p">);</span>
        <span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">option</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-77">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-77">&#182;</a>               </div>               <p>Set the value of the given property on all selected elements to the localized message for the
specified <code>name</code>. <br />
Properties can be identified using paths (e.g. <code>style.direction</code>) to change the values of
<em>deep</em> properties. <br />
Any additional arguments are used as substitutions for numeric placeholders.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">property</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">prop</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">element</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">obj</span><span class="p">,</span> <span class="nx">paths</span>
      <span class="p">,</span> <span class="nx">subs</span>     <span class="o">=</span> <span class="nx">vargs</span><span class="p">(</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
      <span class="p">,</span> <span class="nx">elements</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">)</span>
      <span class="p">,</span> <span class="nx">message</span>  <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">subs</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span> <span class="o">=</span> <span class="nx">elements</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="nx">obj</span>     <span class="o">=</span> <span class="nx">element</span><span class="p">;</span>
      <span class="nx">paths</span>   <span class="o">=</span> <span class="nx">prop</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">obj</span> <span class="o">&amp;&amp;</span> <span class="nx">paths</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">obj</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="nx">paths</span><span class="p">.</span><span class="nx">shift</span><span class="p">()];</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">obj</span><span class="p">[</span><span class="nx">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">message</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">paths</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;innerHTML&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-78">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-78">&#182;</a>               </div>               <p>Traverse the DOM from the specified <code>element</code>, falling back on the configured <code>node</code> if not
provided, and handling all recognized int17 attributes accordingly. <br />
<code>element</code> can either be a DOM node or a query selector string.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Internationalization</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">traverse</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">type</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">element</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">element</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">element</span> <span class="o">=</span> <span class="nx">element</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">node</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">element</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">attribute</span><span class="p">,</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">j</span><span class="p">,</span> <span class="nx">value</span>
      <span class="p">,</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">selector</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">child</span> <span class="o">=</span> <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">attribute</span> <span class="o">=</span> <span class="nx">attributes</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
        <span class="nx">value</span>     <span class="o">=</span> <span class="nx">child</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="nx">attribute</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">handlers</span><span class="p">[</span><span class="nx">attribute</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">child</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">clean</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">child</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="nx">attribute</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">messenger</span><span class="p">.</span><span class="nx">clean</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">SUBS_ATTRIBUTES</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">child</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="nx">SUBS_ATTRIBUTES</span><span class="p">[</span><span class="nx">j</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-79">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-79">&#182;</a>               </div>               <h2>Int17</h2>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-80">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-80">&#182;</a>               </div>               <p>Creates a new instance of <code>Int17</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">Int17</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span>   <span class="o">=</span> <span class="p">{};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="s1">&#39;0.2.2&#39;</span><span class="p">;</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-81">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-81">&#182;</a>               </div>               <p>Remove all internally cached references to shared <code>Internationalization</code> instances.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Int17</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clearCache</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-82">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-82">&#182;</a>               </div>               <p>Create a new instance of <code>Internationalization</code>. <br />
Optionally, named instances can be created and shared. If <code>name</code> is specified the cache will
be checked for existing references and will only create a new instance if one could not be
found.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Int17</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">create</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">name</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">name</span><span class="p">]</span> <span class="o">||</span> <span class="k">new</span> <span class="nx">Internationalization</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">Internationalization</span><span class="p">();</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-83">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-83">&#182;</a>               </div>               <p>Run int17 in <em>noConflict</em> mode, returning the <code>int17</code> variable to its previous owner. <br />
Returns a reference to <code>int17</code>.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Int17</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">noConflict</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">int17</span> <span class="o">=</span> <span class="nx">PREVIOUS_INT17</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-84">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-84">&#182;</a>               </div>               <p>Expose the public API based on the available environment.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">define</span> <span class="o">=</span> <span class="nx">root</span><span class="p">.</span><span class="nx">define</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">module</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-85">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-85">&#182;</a>               </div>               <p>Node.js requires some additional work.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./node&#39;</span><span class="p">).</span><span class="nx">override</span><span class="p">(</span><span class="nx">Internationalization</span><span class="p">,</span> <span class="nx">Messenger</span><span class="p">);</span>
    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Int17</span><span class="p">();</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-86">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-86">&#182;</a>               </div>               <p>Define the module for CommonJS frameworks.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">define</span><span class="p">(</span><span class="s1">&#39;int17&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Int17</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-87">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-87">&#182;</a>               </div>               <p>Fallback on a simple variable attached to the global object.</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">root</span><span class="p">.</span><span class="nx">int17</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Int17</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">}).</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 