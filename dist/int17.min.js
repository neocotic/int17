/*! int17 v0.1.0 | (c) 2013 Alasdair Mercer */(function(){"use strict";function e(e,t){var n=[].slice.call(arguments,2);if("function"==typeof t)t.apply(e,n);else if(n[0])throw n[0]}function t(e,t){var n,r,s=[];for(n=0;t.length>n;n++)r=t[n].match(b),r&&r[1]===e&&s.push(t[n]);return s}function n(e,t,n){if(!n)return e[t];t=t.toLowerCase();for(var r in e)if(t===r.toLowerCase())return e[r]}function r(e){return(e.getAttribute(y)||"").split(";")}function s(e){return function(t){return"string"==typeof t&&t.length||e}}function o(e,t){return e=e&&e.toLowerCase(),function(n){var r=Object.prototype.toString.call(n).toLowerCase();return r==="[object "+e+"]"||t}}function i(e){return function(t,r){var s=n(e,r.toLowerCase(),!1);return"string"==typeof s?s:t}}function a(e,t){return(t?i:l)(e)}function l(e){return function(t,r){var s=n(e,r.toLowerCase(),!0);return s=s&&s.content,"string"==typeof s?s:t}}function c(e,t){var n="Message["+e+"]";if("object"!=typeof t)throw new TypeError(n+" is not an object");if("string"!=typeof t.message)throw new TypeError(n+".message is not a string");if(t.hasOwnProperty("placeholders")&&"object"!=typeof t.placeholders)throw new TypeError(n+".placeholders is not an object")}function h(e,t,n){var r="Message["+e+"].placeholders["+t+"]";if("object"!=typeof n)throw new TypeError(r+" is not an object");if("string"!=typeof n.content)throw new TypeError(r+".content is not a string")}function u(){for(var e=[].slice.call(arguments),t=[],n=0;e.length>n;n++)t=t.concat(e[n]);return t}function p(e){this.int17=e,this.configure()}function f(){this.messenger=new p(this),this.node=j.document}function g(){this.cache={},this.version="0.1.0"}var y="int17-args",v="en",d=this.int17,m=/\$([1-9]\d*)/gi,w=/[\-_]/,b=/^([^\-_]+)[\-_]/,L=/\$(\w+)\$/gi,M=/^([^:]+):(.+)$/,T=/\s/g,j=this,S={"int17-content":function(e,t){e.innerHTML=this.get(t,r(e))},"int17-options":function(e,t){if(t=t.replace(T,"").split(";")){var n,s,o,i=r(e);for(n=0;t.length>n;n++)s=document.createElement("option"),o=t[n].match(M),o?(s.innerHTML=this.get(o[1],i),s.value=o[2]):s.innerHTML=this.get(t[n],i),e.appendChild(s)}},"int17-values":function(e,t){if(t=t.replace(T,"").split(";")){var n,s,o,i,a,l,c=r(e);for(s=0;t.length>s;s++)if(l=t[s].match(M))if(o=l[1],n=l[2],"."===o[0]){for(a=o.slice(1).split("."),i=e;i&&a.length>1;)i=i[a.shift()];if(i)switch(i[a[0]]=this.get(n,c),a[0]){case y:c=r(e);break;case"innerHTML":this.traverse(e)}}else e.setAttribute(o,this.get(n,c)),o===y&&(c=r(e))}}},k=function(){var e,t=[];for(e in S)S.hasOwnProperty(e)&&t.push(e);return t}(),E="["+k.join("],[")+"]";p.prototype.checkMessage=function(e,t){var n,r;this.validate&&c(e,t);for(n in t)if(t.hasOwnProperty(n))switch(r=t[n],n){case"placeholders":"object"==typeof r&&this.checkPlaceholders(e,r);break;case"message":break;default:this.optimize&&delete t[n]}return t},p.prototype.checkMessages=function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.checkMessage(t,e[t]);return e},p.prototype.checkPlaceholders=function(e,t){var n,r,s;for(r in t)t.hasOwnProperty(r)&&(s=t[r],this.validate&&h(e,r,s),this.optimize&&(n=r.toLowerCase(),delete t[r],t[n]=s.content));return t},p.prototype.configure=function(e){return e=e||{},e.locale&&!o("array")(e.locale)&&(e.locale=[e.locale]),this.setUp("encoding",e,"UTF-8",s()),this.setUp("extension",e,".json",s()),this.setUp("fallback",e,!0,o("boolean")),this.setUp("fileName",e,"messages",s()),this.setUp("folders",e,!1,o("boolean")),this.setUp("languages",e,[],o("array")),this.setUp("locale",e,null,o("array")),this.setUp("optimize",e,!0,o("boolean")),this.setUp("path",e,"./locales",s()),this.setUp("separator",e,"/",s()),this.setUp("validate",e,!0,o("boolean")),this.languages.sort(),this.reconfigure()},p.prototype.deriveLocale=function(){return this.locale||(this.locale=(this.extractLocale()||v).split(w)),this.locale},p.prototype.extractLocale=function(){var e=document.getElementsByTagName("html")[0];return e&&e.lang?e.lang:navigator.language?navigator.language:void 0},p.prototype.getMessage=function(e){return this.messages[e]},p.prototype.getLocaleFile=function(e){var t=this.getLocaleParent(!0)+this.separator;return t+=this.folders?this.fileName:this.locale.join("_"),t+=this.extension,e?t:this.resolvePath(t)},p.prototype.getLocaleParent=function(e){var t=this.getLocaleRoot(!0);return this.folders&&(t+=this.separator+this.locale.join("_")),e?t:this.resolvePath(t)},p.prototype.getLocaleRoot=function(e){var t=this.path;return e?t:this.resolvePath(t)},p.prototype.loadMessages=function(t,n){try{if(this.messages)return e(this,n,null,this.messages);this.deriveLocale();var r=this,s=new XMLHttpRequest;s.open("GET",this.getLocaleFile(),!0),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status)try{r.messages=r.parseMessages(s.responseText),e(r,n,null,r.messages)}catch(o){e(r,n,o)}else r.fallback&&t&&r.locale.length>1?(r.locale.pop(),r.loadMessages(!1,n)):e(r,n,Error(s.statusText))},s.send(null)}catch(o){e(this,n,o)}},p.prototype.loadMessagesSync=function(e){if(this.messages)return this.messages;this.deriveLocale();var t=new XMLHttpRequest;if(t.open("GET",this.getLocaleFile(),!1),t.send(null),200===t.status)return this.messages=this.parseMessages(t.responseText);if(this.fallback&&e&&this.locale.length>1)return this.locale.pop(),this.loadMessagesSync(!1);throw Error(t.statusText)},p.prototype.parseMessages=function(e){var t=JSON.parse(e);return(this.optimize||this.validate)&&this.checkMessages(t),t},p.prototype.reconfigure=function(){},p.prototype.resolvePath=function(e){var t=document.createElement("a");return t.href=e,t.href},p.prototype.setUp=function(e,t,n){for(var r=[].slice.call(arguments,3),s=t[e],o=0;r.length>o;o++)if(!r[o](s)){s=n;break}this[e]=s},f.prototype.all=function(e){var t,n,r,s=[].slice.call(arguments,1),o=[];if(e)for(t=0;e.length>t;t++)n=s,r=e[t],"object"==typeof r&&(n=r.args||n,r=r.name),o.push(this.get(r,n));return o},f.prototype.attribute=function(e,t,n){if(!this.node)return this;for(var r=[].slice.call(arguments,3),s=this.node.querySelectorAll(e),o=this.get(n,r),i=0;s.length>i;i++)s[i].setAttribute(t,o);return this},f.prototype.content=function(e,t){if(!this.node)return this;for(var n=[].slice.call(arguments,2),r=this.node.querySelectorAll(e),s=this.get(t,n),o=0;r.length>o;o++)r[o].innerHTML=s;return this},f.prototype.get=function(e){if(e){var t=u(arguments).slice(1),n=this.messenger.getMessage(e);return n&&this.substitute(n,t)}},f.prototype.init=function(t,n){"function"==typeof t&&(n=t,t=null);var r=this;try{this.messenger.configure(t).loadMessages(!0,function(t,s){e(r,n,t,s)})}catch(s){e(this,n,s)}},f.prototype.initSync=function(e){return this.messenger.configure(e).loadMessagesSync(!0),this},f.prototype.languages=function(t,n){"function"==typeof t&&(n=t,t=null);try{var r=this.languagesSync(t);e(this,n,null,r)}catch(s){e(this,n,s)}},f.prototype.languagesSync=function(e){var n=this.messenger.languages;return e?t(e,this.languagesSync()):(n.length||n.push(this.messenger.locale.join("-")),n.slice())},f.prototype.locale=function(){return this.messenger.locale.join("-")},f.prototype.map=function(e){var t,n,r,s=[].slice.call(arguments,1),o={};if(e)for(t=0;e.length>t;t++)n=s,r=e[t],"object"==typeof r&&(n=r.args||n,r=r.name),o[r]=this.get(r,n);return o},f.prototype.options=function(e,t){if(!this.node||!t)return this;var n,r,s,o,i,a=[].slice.call(arguments,2),l=this.node.querySelectorAll(e);for(n=0;l.length>n;n++)for(r=0;t.length>r;r++)s=a,o=t[r],i=document.createElement("option"),"object"==typeof o&&(s=o.args||s,o=o.name,i.value=o.value),i.innerHTML=this.get(o,s),l[n].appendChild(i);return this},f.prototype.property=function(e,t,n){if(!this.node)return this;var r,s,o,i=[].slice.call(arguments,3),a=this.node.querySelectorAll(e),l=this.get(n,i),c=t.split(".");for(s=0;a.length>s;s++){for(r=a[s],o=r;o&&c.length>1;)o=o[c.shift()];o&&(o[c[0]]=l,"innerHTML"===c[0]&&this.traverse(r))}return this},f.prototype.substitute=function(e,t){var n=this.messenger.optimize,r=e.placeholders,s=e.message||"";return r&&(s=s.replace(L,a(r,n))),t&&t.length&&(s=s.replace(m,function(e,n){return n-=1,"string"==typeof t[n]?t[n]:e})),s},f.prototype.traverse=function(e){if(e=e||this.node,!e)return this;var t,n,r,s,o,i=e.querySelectorAll(E);for(r=0;i.length>r;r++)for(n=i[r],s=0;k.length>s;s++)t=k[s],o=n.getAttribute(t),o&&S[t].call(this,n,o);return this},g.prototype.clearCache=function(){return this.cache={},this},g.prototype.create=function(e){return e?this.cache[e]=this.cache[e]||new f:new f},g.prototype.noConflict=function(){return j.int17=d,this};var P=j.define;"object"==typeof module&&module.exports?(require("./node").override(f,p),module.exports=new g):"function"==typeof P&&P.amd?P("int17",function(){return new g}):j.int17=new g}).call(this);