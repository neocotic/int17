/*! int17 v0.1.0 | (c) 2013 Alasdair Mercer */
(function(){"use strict";function f(e,t){var n=[].slice.call(arguments,2);if(typeof t=="function")t.apply(e,n);else if(n[0])throw n[0]}function l(e,t,n){if(!n)return e[t];t=t.toLowerCase();for(var r in e)if(t===r.toLowerCase())return e[r]}function c(t){return(t.getAttribute(e)||"").split(";")}function h(e){return function(t){return typeof t=="string"&&t.length||e}}function p(e,t){return e=e&&e.toLowerCase(),function(n){var r=Object.prototype.toString.call(n).toLowerCase();return r==="[object "+e+"]"||t}}function d(e){return function(t,n){var r=l(e,n.toLowerCase(),!1);return typeof r=="string"?r:t}}function v(e,t){return(t?d:m)(e)}function m(e){return function(t,n){var r=l(e,n.toLowerCase(),!0);return r=r&&r.content,typeof r=="string"?r:t}}function g(e,t){var n="Message["+e+"]";if(typeof t!="object")throw new TypeError(n+" is not an object");if(typeof t.message!="string")throw new TypeError(n+".message is not a string");if(t.hasOwnProperty("placeholders")&&typeof t.placeholders!="object")throw new TypeError(n+".placeholders is not an object")}function y(e,t,n){var r="Message["+e+"].placeholders["+t+"]";if(typeof n!="object")throw new TypeError(r+" is not an object");if(typeof n.content!="string")throw new TypeError(r+".content is not a string")}function b(){var e=[].slice.call(arguments),t=[];for(var n=0;n<e.length;n++)t=t.concat(e[n]);return t}function x(){this.configure()}function T(){this.messenger=new x,this.node=a.document}function N(){this.cache={},this.version="0.1.0"}var e="int17-args",t="en",n=this.int17,r=/\$([1-9]\d*)/gi,i=/[\-_]/,s=/\$(\w+)\$/gi,o=/^([^:]+):(.+)$/,u=/\s/g,a=this,w={"int17-content":function(e,t){e.innerHTML=this.get(t,c(e))},"int17-options":function(e,t){t=t.replace(u,"").split(";");if(!t)return;var n,r,i,s=c(e);for(n=0;n<t.length;n++)r=document.createElement("option"),i=t[n].match(o),i?(r.innerHTML=this.get(i[1],s),r.value=i[2]):r.innerHTML=this.get(t[n],s),e.appendChild(r)},"int17-values":function(t,n){n=n.replace(u,"").split(";");if(!n)return;var r,i,s,a,f,l,h=c(t);for(i=0;i<n.length;i++){l=n[i].match(o);if(!l)continue;s=l[1],r=l[2];if(s[0]==="."){f=s.slice(1).split("."),a=t;while(a&&f.length>1)a=a[f.shift()];if(a){a[f[0]]=this.get(r,h);switch(f[0]){case e:h=c(t);break;case"innerHTML":this.traverse(t)}}}else t.setAttribute(s,this.get(r,h)),s===e&&(h=c(t))}}},E=function(){var e,t=[];for(e in w)w.hasOwnProperty(e)&&t.push(e);return t}(),S="["+E.join("],[")+"]";x.prototype.checkMessage=function(e,t){var n,r;this.validate&&g(e,t);for(n in t){if(!t.hasOwnProperty(n))continue;r=t[n];switch(n){case"placeholders":typeof r=="object"&&this.checkPlaceholders(e,r);break;case"message":break;default:this.optimize&&delete t[n]}}return t},x.prototype.checkMessages=function(e){var t;for(t in e){if(!e.hasOwnProperty(t))continue;this.checkMessage(t,e[t])}return e},x.prototype.checkPlaceholders=function(e,t){var n,r,i;for(r in t){if(!t.hasOwnProperty(r))continue;i=t[r],this.validate&&y(e,r,i),this.optimize&&(n=r.toLowerCase(),delete t[r],t[n]=i.content)}return t},x.prototype.configure=function(e){return e=e||{},this.setUp("encoding",e,"UTF-8",h()),this.setUp("extension",e,".json",h()),this.setUp("fallback",e,!0,p("boolean")),this.setUp("fileName",e,"messages",h()),this.setUp("folders",e,!1,p("boolean")),this.setUp("languages",e,[],p("array")),this.setUp("optimize",e,!0,p("boolean")),this.setUp("path",e,"./locales",h()),this.setUp("validate",e,!0,p("boolean")),this.languages.sort(),this},x.prototype.deriveLocale=function(){return this.locale||(this.locale=(this.extractLocale()||t).split(i)),this.locale},x.prototype.extractLocale=function(){var e=document.getElementsByTagName("html")[0];if(e&&e.lang)return e.lang;if(navigator.language)return navigator.language},x.prototype.getMessage=function(e){return this.messages[e]},x.prototype.getLocaleFile=function(e){var t=this.getLocaleParent(!0)+"/";return t+=this.folders?this.fileName:this.locale.join("_"),t+=this.extension,e?t:this.resolvePath(t)},x.prototype.getLocaleParent=function(e){var t=this.getLocaleRoot(!0);return this.folders&&(t+="/"+this.locale.join("_")),e?t:this.resolvePath(t)},x.prototype.getLocaleRoot=function(e){var t=this.path;return e?t:this.resolvePath(t)},x.prototype.loadMessages=function(e,t){if(this.messages)return t(null,this.messages);this.deriveLocale();var n=this,r=new XMLHttpRequest;r.open("GET",this.getLocaleFile(),!0),r.onreadystatechange=function(){if(r.readyState===4)if(r.status===200)try{n.messages=n.parseMessages(r.responseText),t(null,n.messages)}catch(i){t(i)}else n.fallback&&e&&n.locale.length>1?(n.locale.pop(),n.loadMessages(!1,t)):t(new Error(r.statusText))},r.send(null)},x.prototype.loadMessagesSync=function(e){if(this.messages)return this.messages;this.deriveLocale();var t=new XMLHttpRequest;t.open("GET",this.getLocaleFile(),!1),t.send(null);if(t.status===200)return this.messages=this.parseMessages(t.responseText);if(this.fallback&&e&&this.locale.length>1)return this.locale.pop(),this.loadMessagesSync(!1);throw new Error(t.statusText)},x.prototype.parseMessages=function(e){var t=JSON.parse(e);return(this.optimize||this.validate)&&this.checkMessages(t),t},x.prototype.resolvePath=function(e){var t=document.createElement("a");return t.href=e,t.href},x.prototype.setUp=function(e,t,n){var r=[].slice.call(arguments,3),i=t[e];for(var s=0;s<r.length;s++)if(!r[s](i)){i=n;break}this[e]=i},T.prototype.all=function(e){var t,n,r,i=[].slice.call(arguments,1),s=[];if(e)for(t=0;t<e.length;t++)n=i,r=e[t],typeof r=="object"&&(n=r.args||n,r=r.name),s.push(this.get(r,n));return s},T.prototype.attribute=function(e,t,n){if(!this.node)return this;var r=[].slice.call(arguments,3),i=this.node.querySelectorAll(e),s=this.get(n,r);for(var o=0;o<i.length;o++)i[o].setAttribute(t,s);return this},T.prototype.content=function(e,t){if(!this.node)return this;var n=[].slice.call(arguments,2),r=this.node.querySelectorAll(e),i=this.get(t,n);for(var s=0;s<r.length;s++)r[s].innerHTML=i;return this},T.prototype.get=function(e){if(!e)return;var t=b(arguments).slice(1),n=this.messenger.getMessage(e);return n&&this.substitute(n,t)},T.prototype.init=function(e,t){typeof e=="function"&&(t=e,e=null);var n=this;this.messenger.configure(e).loadMessages(!0,function(e,r){f(n,t,e,r)})},T.prototype.initSync=function(e){return this.messenger.configure(e).loadMessagesSync(!0),this},T.prototype.languages=function(e,t){typeof e=="function"&&(t=e,e=null),f(this,t,null,this.languagesSync(e))},T.prototype.languagesSync=function(e){var t=this.messenger.languages;t.length||(t.push(this.messenger.locale.join("-")),t.sort());if(e){var n=[];return e===t[0].slice(0,e.length)&&(e.length!==t[0].length&&n.push(e),n.push(t[0])),n}return t.slice()},T.prototype.locale=function(){return this.messenger.locale.join("-")},T.prototype.map=function(e){var t,n,r,i=[].slice.call(arguments,1),s={};if(e)for(t=0;t<e.length;t++)n=i,r=e[t],typeof r=="object"&&(n=r.args||n,r=r.name),s[r]=this.get(r,n);return s},T.prototype.options=function(e,t){if(!this.node||!t)return this;var n,r,i,s,o,u=[].slice.call(arguments,2),a=this.node.querySelectorAll(e);for(n=0;n<a.length;n++)for(r=0;r<t.length;r++)i=u,s=t[r],o=document.createElement("option"),typeof s=="object"&&(i=s.args||i,s=s.name,o.value=s.value),o.innerHTML=this.get(s,i),a[n].appendChild(o);return this},T.prototype.property=function(e,t,n){if(!this.node)return this;var r,i,s,o=[].slice.call(arguments,3),u=this.node.querySelectorAll(e),a=this.get(n,o),f=t.split(".");for(i=0;i<u.length;i++){r=u[i],s=r;while(s&&f.length>1)s=s[f.shift()];s&&(s[f[0]]=a,f[0]==="innerHTML"&&this.traverse(r))}return this},T.prototype.substitute=function(e,t){var n=this.messenger.optimize,i=e.placeholders,o=e.message||"";return i&&(o=o.replace(s,v(i,n))),t&&t.length&&(o=o.replace(r,function(e,n){return n-=1,typeof t[n]=="string"?t[n]:e})),o},T.prototype.traverse=function(e){e=e||this.node;if(!e)return this;var t,n,r,i,s,o=e.querySelectorAll(S);for(r=0;r<o.length;r++){n=o[r];for(i=0;i<E.length;i++)t=E[i],s=n.getAttribute(t),s&&w[t].call(this,n,s)}return this},N.prototype.clearCache=function(){return this.cache={},this},N.prototype.create=function(e){return e?this.cache[e]=this.cache[e]||new T:new T},N.prototype.noConflict=function(){return a.int17=n,this};var C=a.define;typeof module=="object"&&module.exports?(require("./node").override(T,x),module.exports=new N):typeof C=="function"&&C.amd?C("int17",function(){return new N}):a.int17=new N}).call(this);