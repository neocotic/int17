/*! int17 v0.2.2 | (c) 2013 Alasdair Mercer | MIT License */
!function(){"use strict";function a(a){return H.call(a).toLowerCase().slice(8,-1)}function b(b,c){var d=G.call(arguments,2);if("function"===a(c))c.apply(b,d);else if(d[0])throw d[0]}function c(a){return a?(""+a).replace(x,function(a){return u[a]}):""}function d(a,b){var c,d,e=[];for(c=0;c<b.length;c++)d=b[c].match(z),d&&d[1]===a&&e.push(b[c]);return e}function e(a,b,c){if(!c)return a[b];b=b.toLowerCase();for(var d in a)if(b===d.toLowerCase())return a[d]}function f(a){var b,c,d=[];for(b=0;b<E.length;b++)c=a.getAttribute(E[b]),d=d.concat(c?c.split(";"):[]);return d}function g(b){return function(c){return"string"===a(c)&&c.length||b}}function h(b,c){return b=b&&b.toLowerCase(),function(d){return a(d)===b||c}}function i(b){return function(c,d){var f=e(b,d.toLowerCase(),!1);return"string"===a(f)?f:c}}function j(a,b){return(b?i:k)(a)}function k(b){return function(c,d){var f=e(b,d.toLowerCase(),!0);return f=f&&f.content,"string"===a(f)?f:c}}function l(b,c,d){var e=b.placeholders,f=b.message||"";return e&&(f=f.replace(A,j(e,c))),d&&d.length&&(f=f.replace(B,function(b,c){return c-=1,"string"===a(d[c])?d[c]:b})),f}function m(b,c){var d="Message["+b+"]";if("object"!==a(c))throw new TypeError(d+" is not an object");if("string"!==a(c.message))throw new TypeError(d+".message is not a string");if(c.hasOwnProperty("placeholders")&&"object"!==a(c.placeholders))throw new TypeError(d+".placeholders is not an object")}function n(b,c,d){var e="Message["+b+"].placeholders["+c+"]";if("object"!==a(d))throw new TypeError(e+" is not an object");if("string"!==a(d.content))throw new TypeError(e+".content is not a string")}function o(a){var b=[];a=G.call(a);for(var c=0;c<a.length;c++)b=b.concat(a[c]);return b}function p(a){this.int17=a,this.configure()}function q(){function a(a){c.escape[a]=function(){var b,d=c.escaping;c.escaping=!0;try{b=c[a].apply(c,G.call(arguments))}finally{d||delete c.escaping}return b}}this.messenger=new p(this),this.node=F.document;var b,c=this;for(this.escape={},b=0;b<v.length;b++)a(v[b])}function r(){this.cache={},this.version="0.2.2"}var s="data-",t="en",u={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"},v=["all","get","map"],w=this.int17,x=function(){var a=[];for(var b in u)a.push(b);return new RegExp("["+a.join("")+"]","g")}(),y=/[\-_]/,z=/^([^\-_]+)[\-_]/,A=/\$(\w+)\$/gi,B=/\$([1-9]\d*)/gi,C=/^([^:]+):(.+)$/,D=/\s/g,E=["int17-subs"];E.push(s+E[0]);var F=this,G=Array.prototype.slice,H=Object.prototype.toString,I={"int17-content":function(a,b){a.innerHTML=this.get(b,f(a))},"int17-options":function(a,b){if(b=b.replace(D,"").split(";")){var c,d,e,g=f(a);for(c=0;c<b.length;c++)d=document.createElement("option"),e=b[c].match(C),e?(d.innerHTML=this.get(e[1],g),d.value=e[2]):d.innerHTML=this.get(b[c],g),a.appendChild(d)}},"int17-values":function(a,b){if(b=b.replace(D,"").split(";")){var c,d,e,g,h,i,j=f(a);for(d=0;d<b.length;d++)if(i=b[d].match(C))if(e=i[1],c=i[2],"."===e[0]){for(h=e.slice(1).split("."),g=a;g&&h.length>1;)g=g[h.shift()];g&&(g[h[0]]=this.get(c,j),~E.indexOf(h[0])?j=f(a):"innerHTML"===h[0]&&this.traverse(a))}else a.setAttribute(e,this.get(c,j)),~E.indexOf(e)&&(j=f(a))}}},J=function(){function a(a){return function(){I[a].apply(this,arguments)}}var b,c,d=[];for(b in I)I.hasOwnProperty(b)&&(c=s+b,I[c]=a(b),d.push(b,c));return d}(),K="["+J.join("],[")+"]";p.prototype.checkMessage=function(b,c){var d,e;this.validate&&m(b,c);for(d in c)if(c.hasOwnProperty(d))switch(e=c[d],d){case"placeholders":"object"===a(e)&&this.checkPlaceholders(b,e);break;case"message":break;default:this.optimize&&delete c[d]}return c},p.prototype.checkMessages=function(a){var b;for(b in a)a.hasOwnProperty(b)&&this.checkMessage(b,a[b]);return a},p.prototype.checkPlaceholders=function(a,b){var c,d,e;for(d in b)b.hasOwnProperty(d)&&(e=b[d],this.validate&&n(a,d,e),this.optimize&&(c=d.toLowerCase(),delete b[d],b[c]=e.content));return b},p.prototype.configure=function(b){return b=b||{},b.locale&&"array"!==a(b.locale)&&(b.locale=b.locale.split(y)),delete this.messages,this.setUp("clean",b,!1,h("boolean")),this.setUp("encoding",b,"UTF-8",g()),this.setUp("extension",b,".json",g()),this.setUp("fallback",b,!1,h("boolean")),this.setUp("fileName",b,"messages",g()),this.setUp("folders",b,!1,h("boolean")),this.setUp("languages",b,[],h("array")),this.setUp("locale",b,null,h("array")),this.setUp("optimize",b,!0,h("boolean")),this.setUp("path",b,"./locales",g()),this.setUp("separator",b,"/",g()),this.setUp("validate",b,!0,h("boolean")),this.languages.sort(),this.reconfigure()},p.prototype.deriveLocale=function(){return this.locale||(this.locale=(this.extractLocale()||t).split(y)),this.locale},p.prototype.extractLocale=function(){var a=document.getElementsByTagName("html")[0];return a&&a.lang?a.lang:navigator.language?navigator.language:void 0},p.prototype.getMessage=function(a){return this.messages[a]},p.prototype.getLocaleFile=function(a){var b=this.getLocaleParent(!0)+this.separator;return b+=this.folders?this.fileName:this.locale.join("_"),b+=this.extension,a?b:this.resolvePath(b)},p.prototype.getLocaleParent=function(a){var b=this.getLocaleRoot(!0);return this.folders&&(b+=this.separator+this.locale.join("_")),a?b:this.resolvePath(b)},p.prototype.getLocaleRoot=function(a){var b=this.path;return a?b:this.resolvePath(b)},p.prototype.loadMessages=function(a,c){try{if(this.messages)return b(this,c,null,this.messages);this.deriveLocale();var d=this,e=new XMLHttpRequest;e.open("GET",this.getLocaleFile(),!0),e.onreadystatechange=function(){if(4===e.readyState)if(200===e.status)try{d.messages=d.parseMessages(e.responseText),b(d,c,null,d.messages)}catch(f){b(d,c,f)}else d.fallback&&a&&d.locale.length>1?(d.locale.pop(),d.loadMessages(!1,c)):b(d,c,new Error(e.statusText))},e.send(null)}catch(f){b(this,c,f)}},p.prototype.loadMessagesSync=function(a){if(this.messages)return this.messages;this.deriveLocale();var b=new XMLHttpRequest;if(b.open("GET",this.getLocaleFile(),!1),b.send(null),200===b.status)return this.messages=this.parseMessages(b.responseText);if(this.fallback&&a&&this.locale.length>1)return this.locale.pop(),this.loadMessagesSync(!1);throw new Error(b.statusText)},p.prototype.parseMessages=function(a){var b=JSON.parse(a);return(this.optimize||this.validate)&&this.checkMessages(b),b},p.prototype.reconfigure=function(){return this},p.prototype.resolvePath=function(a){var b=document.createElement("a");return b.href=a,b.href},p.prototype.setUp=function(a,b,c){for(var d=G.call(arguments,3),e=b[a],f=0;f<d.length;f++)if(!d[f](e)){e=this.hasOwnProperty(a)?this[a]:c;break}this[a]=e},q.prototype.all=function(b){var c,d,e,f=[],g=o(G.call(arguments,1));if(b)for(c=0;c<b.length;c++)d=g,e=b[c],"object"===a(e)&&(d=e.subs||d,e=e.name),f.push(this.get(e,d));return f},q.prototype.attribute=function(a,b,c){if(!this.node)return this;for(var d=o(G.call(arguments,3)),e=this.node.querySelectorAll(a),f=this.get(c,d),g=0;g<e.length;g++)e[g].setAttribute(b,f);return this},q.prototype.content=function(a,b){if(!this.node)return this;for(var c=o(G.call(arguments,2)),d=this.node.querySelectorAll(a),e=this.get(b,c),f=0;f<d.length;f++)d[f].innerHTML=e;return this},q.prototype.get=function(a){if(a){var b=o(G.call(arguments,1)),d=this.messenger.getMessage(a);return d=d&&l(d,this.messenger.optimize,b),this.escaping?c(d):d}},q.prototype.init=function(c,d){"function"===a(c)&&(d=c,c=null);var e=this;try{this.messenger.configure(c).loadMessages(!0,function(a){b(e,d,a)})}catch(f){b(this,d,f)}},q.prototype.initSync=function(a){return this.messenger.configure(a).loadMessagesSync(!0),this},q.prototype.languages=function(c,d){"function"===a(c)&&(d=c,c=null);try{var e=this.languagesSync(c);b(this,d,null,e)}catch(f){b(this,d,f)}},q.prototype.languagesSync=function(a){var b=this.messenger.languages;return a?d(a,this.languagesSync()):(b.length||b.push(this.messenger.locale.join("-")),G.call(b))},q.prototype.locale=function(){return this.messenger.locale.join("-")},q.prototype.map=function(b){var c,d,e,f={},g=o(G.call(arguments,1));if(b)for(c=0;c<b.length;c++)d=g,e=b[c],"object"===a(e)&&(d=e.subs||d,e=e.name),f[e]=this.get(e,d);return f},q.prototype.options=function(b,c){if(!this.node||!c)return this;var d,e,f,g,h,i=this.node.querySelectorAll(b),j=o([].slice.call(arguments,2));for(d=0;d<i.length;d++)for(e=0;e<c.length;e++)f=j,g=c[e],h=document.createElement("option"),"object"===a(g)&&(g.value&&(h.value=g.value),f=g.subs||f,g=g.name),h.innerHTML=this.get(g,f),i[d].appendChild(h);return this},q.prototype.property=function(a,b,c){if(!this.node)return this;var d,e,f,g,h=o(G.call(arguments,3)),i=this.node.querySelectorAll(a),j=this.get(c,h);for(e=0;e<i.length;e++){for(d=i[e],f=d,g=b.split(".");f&&g.length>1;)f=f[g.shift()];f&&(f[g[0]]=j,"innerHTML"===g[0]&&this.traverse(d))}return this},q.prototype.traverse=function(b){if("string"===a(b)&&(b=this.node.querySelector(b)),b=b||this.node,!b)return this;var c,d,e,f,g,h=b.querySelectorAll(K);for(e=0;e<h.length;e++){for(d=h[e],f=0;f<J.length;f++)c=J[f],g=d.getAttribute(c),g&&(I[c].call(this,d,g),this.messenger.clean&&d.removeAttribute(c));if(this.messenger.clean)for(f=0;f<E.length;f++)d.removeAttribute(E[f])}return this},r.prototype.clearCache=function(){return this.cache={},this},r.prototype.create=function(a){return a?this.cache[a]=this.cache[a]||new q:new q},r.prototype.noConflict=function(){return F.int17=w,this};var L=F.define;"object"==typeof module&&module.exports?(require("./node").override(q,p),module.exports=new r):"function"==typeof L&&L.amd?L("int17",function(){return new r}):F.int17=new r}.call(this);