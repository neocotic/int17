/*! int17 v0.1.0 | (c) 2013 Alasdair Mercer */(function(){"use strict";function e(e,t){var n=[].slice.call(arguments,2);if("function"==typeof t)t.apply(e,n);else if(n[0])throw n[0]}function t(e,t){var n,r,s=[];for(n=0;t.length>n;n++)r=t[n].match(L),r&&r[1]===e&&s.push(t[n]);return s}function n(e,t,n){if(!n)return e[t];t=t.toLowerCase();for(var r in e)if(t===r.toLowerCase())return e[r]}function r(e){var t=e.getAttribute(v);return t?t.split(";"):[]}function s(e){return function(t){return"string"==typeof t&&t.length||e}}function o(e,t){return e=e&&e.toLowerCase(),function(n){var r=Object.prototype.toString.call(n).toLowerCase();return r==="[object "+e+"]"||t}}function i(e){return function(t,r){var s=n(e,r.toLowerCase(),!1);return"string"==typeof s?s:t}}function a(e,t){return(t?i:l)(e)}function l(e){return function(t,r){var s=n(e,r.toLowerCase(),!0);return s=s&&s.content,"string"==typeof s?s:t}}function c(e,t,n){var r=e.placeholders,s=e.message||"";return r&&(s=s.replace(M,a(r,t))),n&&n.length&&(s=s.replace(w,function(e,t){return t-=1,"string"==typeof n[t]?n[t]:e})),s}function h(e,t){var n="Message["+e+"]";if("object"!=typeof t)throw new TypeError(n+" is not an object");if("string"!=typeof t.message)throw new TypeError(n+".message is not a string");if(t.hasOwnProperty("placeholders")&&"object"!=typeof t.placeholders)throw new TypeError(n+".placeholders is not an object")}function u(e,t,n){var r="Message["+e+"].placeholders["+t+"]";if("object"!=typeof n)throw new TypeError(r+" is not an object");if("string"!=typeof n.content)throw new TypeError(r+".content is not a string")}function p(e){var t=[];e=[].slice.call(e);for(var n=0;e.length>n;n++)t=t.concat(e[n]);return t}function f(e){this.int17=e,this.configure()}function g(){this.messenger=new f(this),this.node=S.document}function y(){this.cache={},this.version="0.1.0"}var v="int17-args",m="en",d=this.int17,w=/\$([1-9]\d*)/gi,b=/[\-_]/,L=/^([^\-_]+)[\-_]/,M=/\$(\w+)\$/gi,T=/^([^:]+):(.+)$/,j=/\s/g,S=this,P={"int17-content":function(e,t){e.innerHTML=this.get(t,r(e))},"int17-options":function(e,t){if(t=t.replace(j,"").split(";")){var n,s,o,i=r(e);for(n=0;t.length>n;n++)s=document.createElement("option"),o=t[n].match(T),o?(s.innerHTML=this.get(o[1],i),s.value=o[2]):s.innerHTML=this.get(t[n],i),e.appendChild(s)}},"int17-values":function(e,t){if(t=t.replace(j,"").split(";")){var n,s,o,i,a,l,c=r(e);for(s=0;t.length>s;s++)if(l=t[s].match(T))if(o=l[1],n=l[2],"."===o[0]){for(a=o.slice(1).split("."),i=e;i&&a.length>1;)i=i[a.shift()];if(i)switch(i[a[0]]=this.get(n,c),a[0]){case v:c=r(e);break;case"innerHTML":this.traverse(e)}}else e.setAttribute(o,this.get(n,c)),o===v&&(c=r(e))}}},U=function(){var e,t=[];for(e in P)P.hasOwnProperty(e)&&t.push(e);return t}(),k="["+U.join("],[")+"]";f.prototype.checkMessage=function(e,t){var n,r;this.validate&&h(e,t);for(n in t)if(t.hasOwnProperty(n))switch(r=t[n],n){case"placeholders":"object"==typeof r&&this.checkPlaceholders(e,r);break;case"message":break;default:this.optimize&&delete t[n]}return t},f.prototype.checkMessages=function(e){var t;for(t in e)e.hasOwnProperty(t)&&this.checkMessage(t,e[t]);return e},f.prototype.checkPlaceholders=function(e,t){var n,r,s;for(r in t)t.hasOwnProperty(r)&&(s=t[r],this.validate&&u(e,r,s),this.optimize&&(n=r.toLowerCase(),delete t[r],t[n]=s.content));return t},f.prototype.configure=function(e){return e=e||{},e.locale&&!o("array")(e.locale)&&(e.locale=e.locale.split(b)),delete this.messages,this.setUp("clean",e,!1,o("boolean")),this.setUp("encoding",e,"UTF-8",s()),this.setUp("extension",e,".json",s()),this.setUp("fallback",e,!1,o("boolean")),this.setUp("fileName",e,"messages",s()),this.setUp("folders",e,!1,o("boolean")),this.setUp("languages",e,[],o("array")),this.setUp("locale",e,null,o("array")),this.setUp("optimize",e,!0,o("boolean")),this.setUp("path",e,"./locales",s()),this.setUp("separator",e,"/",s()),this.setUp("validate",e,!0,o("boolean")),this.languages.sort(),this.reconfigure()},f.prototype.deriveLocale=function(){return this.locale||(this.locale=(this.extractLocale()||m).split(b)),this.locale},f.prototype.extractLocale=function(){var e=document.getElementsByTagName("html")[0];return e&&e.lang?e.lang:navigator.language?navigator.language:void 0},f.prototype.getMessage=function(e){return this.messages[e]},f.prototype.getLocaleFile=function(e){var t=this.getLocaleParent(!0)+this.separator;return t+=this.folders?this.fileName:this.locale.join("_"),t+=this.extension,e?t:this.resolvePath(t)},f.prototype.getLocaleParent=function(e){var t=this.getLocaleRoot(!0);return this.folders&&(t+=this.separator+this.locale.join("_")),e?t:this.resolvePath(t)},f.prototype.getLocaleRoot=function(e){var t=this.path;return e?t:this.resolvePath(t)},f.prototype.loadMessages=function(t,n){try{if(this.messages)return e(this,n,null,this.messages);this.deriveLocale();var r=this,s=new XMLHttpRequest;s.open("GET",this.getLocaleFile(),!0),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status)try{r.messages=r.parseMessages(s.responseText),e(r,n,null,r.messages)}catch(o){e(r,n,o)}else r.fallback&&t&&r.locale.length>1?(r.locale.pop(),r.loadMessages(!1,n)):e(r,n,Error(s.statusText))},s.send(null)}catch(o){e(this,n,o)}},f.prototype.loadMessagesSync=function(e){if(this.messages)return this.messages;this.deriveLocale();var t=new XMLHttpRequest;if(t.open("GET",this.getLocaleFile(),!1),t.send(null),200===t.status)return this.messages=this.parseMessages(t.responseText);if(this.fallback&&e&&this.locale.length>1)return this.locale.pop(),this.loadMessagesSync(!1);throw Error(t.statusText)},f.prototype.parseMessages=function(e){var t=JSON.parse(e);return(this.optimize||this.validate)&&this.checkMessages(t),t},f.prototype.reconfigure=function(){return this},f.prototype.resolvePath=function(e){var t=document.createElement("a");return t.href=e,t.href},f.prototype.setUp=function(e,t,n){for(var r=[].slice.call(arguments,3),s=t[e],o=0;r.length>o;o++)if(!r[o](s)){s=this.hasOwnProperty(e)?this[e]:n;break}this[e]=s},g.prototype.all=function(e){var t,n,r,s=p([].slice.call(arguments,1)),o=[];if(e)for(t=0;e.length>t;t++)n=s,r=e[t],"object"==typeof r&&(n=r.args||n,r=r.name),o.push(this.get(r,n));return o},g.prototype.attribute=function(e,t,n){if(!this.node)return this;for(var r=p([].slice.call(arguments,3)),s=this.node.querySelectorAll(e),o=this.get(n,r),i=0;s.length>i;i++)s[i].setAttribute(t,o);return this},g.prototype.content=function(e,t){if(!this.node)return this;for(var n=p([].slice.call(arguments,2)),r=this.node.querySelectorAll(e),s=this.get(t,n),o=0;r.length>o;o++)r[o].innerHTML=s;return this},g.prototype.get=function(e){if(e){var t=p([].slice.call(arguments,1)),n=this.messenger.getMessage(e);return n&&c(n,this.messenger.optimize,t)}},g.prototype.init=function(t,n){"function"==typeof t&&(n=t,t=null);var r=this;try{this.messenger.configure(t).loadMessages(!0,function(t){e(r,n,t)})}catch(s){e(this,n,s)}},g.prototype.initSync=function(e){return this.messenger.configure(e).loadMessagesSync(!0),this},g.prototype.languages=function(t,n){"function"==typeof t&&(n=t,t=null);try{var r=this.languagesSync(t);e(this,n,null,r)}catch(s){e(this,n,s)}},g.prototype.languagesSync=function(e){var n=this.messenger.languages;return e?t(e,this.languagesSync()):(n.length||n.push(this.messenger.locale.join("-")),n.slice())},g.prototype.locale=function(){return this.messenger.locale.join("-")},g.prototype.map=function(e){var t,n,r,s=p([].slice.call(arguments,1)),o={};if(e)for(t=0;e.length>t;t++)n=s,r=e[t],"object"==typeof r&&(n=r.args||n,r=r.name),o[r]=this.get(r,n);return o},g.prototype.options=function(e,t){if(!this.node||!t)return this;var n,r,s,o,i,a=p([].slice.call(arguments,2)),l=this.node.querySelectorAll(e);for(n=0;l.length>n;n++)for(r=0;t.length>r;r++)s=a,o=t[r],i=document.createElement("option"),"object"==typeof o&&(o.value&&(i.value=o.value),s=o.args||s,o=o.name),i.innerHTML=this.get(o,s),l[n].appendChild(i);return this},g.prototype.property=function(e,t,n){if(!this.node)return this;var r,s,o,i=p([].slice.call(arguments,3)),a=this.node.querySelectorAll(e),l=this.get(n,i),c=t.split(".");for(s=0;a.length>s;s++){for(r=a[s],o=r;o&&c.length>1;)o=o[c.shift()];o&&(o[c[0]]=l,"innerHTML"===c[0]&&this.traverse(r))}return this},g.prototype.traverse=function(e){if(o("string")(e)&&(e=this.node.querySelector(e)),e=e||this.node,!e)return this;var t,n,r,s,i,a=e.querySelectorAll(k);for(r=0;a.length>r;r++){for(n=a[r],s=0;U.length>s;s++)t=U[s],i=n.getAttribute(t),i&&(P[t].call(this,n,i),this.messenger.clean&&n.removeAttribute(t));this.messenger.clean&&n.removeAttribute(v)}return this},y.prototype.clearCache=function(){return this.cache={},this},y.prototype.create=function(e){return e?this.cache[e]=this.cache[e]||new g:new g},y.prototype.noConflict=function(){return S.int17=d,this};var E=S.define;"object"==typeof module&&module.exports?(require("./node").override(g,f),module.exports=new y):"function"==typeof E&&E.amd?E("int17",function(){return new y}):S.int17=new y}).call(this);